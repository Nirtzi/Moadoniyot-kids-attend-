<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª × ×•×›×—×•×ª ××•×¢×“×•× ×™×•×ª</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; direction: rtl; }
        .card { background: white; padding: 20px; border-radius: 15px; shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; text-align: center; }
        h1 { color: #1e1b4b; }
        .btn { background: #4f46e5; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; }
        .student-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .present { color: green; font-weight: bold; }
        .absent { color: red; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const isAdmin = params.get('admin') === 'true';
        const clubId = params.get('club');
        const app = document.getElementById('app');

        const clubs = [
            { id: 0, name: '××•×¢×“×•× ×™×ª ××³', students: ['×“× ×™ ×›×”×Ÿ', '×©×™×¨×” ×œ×•×™', '×™×•×¡×™ ××–×¨×—×™', '× ×•×¢×” ×‘×¨×§'] },
            { id: 1, name: '××•×¢×“×•× ×™×ª ×‘×³', students: ['××™×›×œ ××‘× ×™', '×¢×•××¨ ×“×•×“', '×ª××¨ ×’×•×œ×Ÿ', '××•×¨×™ ×¤×¨×¥'] },
            { id: 2, name: '××•×¢×“×•× ×™×ª ×’×³', students: ['××™×” ×¨×•×–×Ÿ', '×’×™×œ ××•×¨', '×©× ×™ ××¨×“', '×˜×œ ×‘×Ÿ ×“×•×“'] }
        ];

        function render() {
            if (isAdmin) {
                let html = '<div class="card"><h1>× ×™×”×•×œ ××•×¢×“×•× ×™×•×ª ğŸ”‘</h1>';
                clubs.forEach(club => {
                    html += `<h3>${club.name}</h3>`;
                    club.students.forEach(s => html += `<div class="student-row"><span>${s}</span><span class="present">×¨×©×•×</span></div>`);
                });
                html += '</div>';
                app.innerHTML = html;
            } else if (clubId !== null) {
                const club = clubs[clubId];
                let html = `<div class="card"><h1>× ×•×›×—×•×ª: ${club.name}</h1>`;
                club.students.forEach(s => {
                    html += `<div class="student-row"><span>${s}</span><button class="btn" onclick="this.innerText='âœ…'; this.style.background='green'">×¡××Ÿ × ×•×›×—×•×ª</button></div>`;
                });
                html += '</div>';
                app.innerHTML = html;
            } else {
                app.innerHTML = '<div class="card"><h1>×©×œ×•×! ğŸ‘‹</h1><p>× × ×œ×”×©×ª××© ×‘×§×™×©×•×¨ ×”××™×©×™ ×©×§×™×‘×œ×ª ×›×“×™ ×œ×”×™×›× ×¡ ×œ××¢×¨×›×ª.</p></div>';
            }
        }
        render();
    </script>
</body>
</html>
                { id: 2, name: '××•×¢×“×•× ×™×ª ×’×³', students: ['××™×” ×¨×•×–×Ÿ', '×’×™×œ ××•×¨', '×©× ×™ ××¨×“', '×¢×“×™ × ×—×•×', '×˜×œ ×‘×Ÿ ×“×•×“'] }
            ]);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const club = params.get('club');
                const admin = params.get('admin');
                if (admin === 'true') setIsAdmin(true);
                else if (club !== null) setClubId(parseInt(club));
            }, []);

            useEffect(() => {
                const loadData = async () => {
                    const saved = await storage.get('attendance-data');
                    if (saved) setAttendanceData(JSON.parse(saved));
                    const savedClubs = await storage.get('clubs-data');
                    if (savedClubs) setClubs(JSON.parse(savedClubs));
                    const savedNotes = await storage.get('daily-notes');
                    if (savedNotes) setDailyNotes(JSON.parse(savedNotes));
                };
                loadData();
            }, []);

            const backupData = () => {
                const data = { attendanceData, clubs, dailyNotes };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `×’×™×‘×•×™_××•×¢×“×•× ×™×•×ª_${currentDate}.json`;
                link.click();
            };

            const toggleAttendance = (clubId, studentName) => {
                const key = `${currentDate}-${clubId}-${studentName}`;
                const newData = { ...attendanceData, [key]: !attendanceData[key] };
                setAttendanceData(newData);
                storage.set('attendance-data', JSON.stringify(newData));
            };

            const isPresent = (cId, sName, date = currentDate) => attendanceData[`${date}-${cId}-${sName}`] || false;

            const StaffView = () => {
                const currentClub = clubs.find(c => c.id === clubId);
                if (!currentClub) return null;
                const filteredStudents = currentClub.students.filter(s => s.includes(searchTerm));

                return (
                    <div className="space-y-6">
                        <div className="bg-white p-4 rounded-xl shadow-sm flex gap-2 items-center">
                            <Search className="text-gray-400" size={20} />
                            <input 
                                type="text" 
                                placeholder="×—×™×¤×•×© ×™×œ×“..." 
                                className="w-full text-right outline-none"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-2xl font-bold mb-6 text-gray-800">{currentClub.name}</h3>
                            <div className="space-y-3">
                                {filteredStudents.map((student, idx) => (
                                    <button key={idx} onClick={() => toggleAttendance(clubId, student)}
                                        className={`w-full flex items-center gap-3 p-4 rounded-lg border-2 transition-all ${isPresent(clubId, student) ? 'bg-green-50 border-green-400' : 'bg-gray-50 border-gray-200'}`}>
                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center ${isPresent(clubId, student) ? 'bg-green-500' : 'bg-gray-300'}`}>
                                            {isPresent(clubId, student) && <Check className="text-white" size={16} />}
                                        </div>
                                        <span className="text-lg">{student}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // ... (×©××¨ ×—×œ×§×™ ×”-AdminView ×•×”-ReportsView × ×©××¨×™× ×“×•××™× ×œ×§×•×“ ×”××§×•×¨×™ ×©×œ×š)

            if (clubId === null && !isAdmin) return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100 p-6 text-center">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full">
                        <h1 className="text-2xl font-bold mb-4">×©×œ×•×! ğŸ‘‹</h1>
                        <p>×× × ×”×©×ª××©×™ ×‘×§×™×©×•×¨ ×”××™×©×™ ×©× ×©×œ×— ××œ×™×™×š ×›×“×™ ×œ×”×™×›× ×¡ ×œ××¢×¨×›×ª.</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-indigo-50 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold text-indigo-900">× ×•×›×—×•×ª: {isAdmin ? "× ×™×”×•×œ" : clubs[clubId]?.name}</h1>
                            <button onClick={backupData} className="flex gap-2 items-center bg-white px-4 py-2 rounded-lg shadow text-sm hover:bg-gray-50">
                                <Save size={18} /> ×’×™×‘×•×™ × ×ª×•× ×™×
                            </button>
                        </div>
                        {viewMode === 'staff' && !isAdmin && <StaffView />}
                        {isAdmin && <div className="text-center p-10 bg-white rounded-xl shadow">×ª×¦×•×’×ª ×× ×”×œ - ×›×œ ×”××•×¢×“×•× ×™×•×ª ×›××Ÿ</div>}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AttendanceApp />, document.getElementById('root'));
    </script>
</body>
</html>
