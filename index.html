<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注专转 转 注转</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Check, X, Users, Calendar, Eye, Edit3, FileSpreadsheet, AlertTriangle, TrendingUp, Download, MessageSquare, Search, Save } = lucide;

        const storage = {
            async get(key) { return localStorage.getItem(key); },
            async set(key, value) { localStorage.setItem(key, value); }
        };

        const AttendanceApp = () => {
            const [clubId, setClubId] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [viewMode, setViewMode] = useState('staff');
            const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
            const [attendanceData, setAttendanceData] = useState({});
            const [dailyNotes, setDailyNotes] = useState({});
            const [searchTerm, setSearchTerm] = useState('');
            const [alerts, setAlerts] = useState([]);
            const [clubs, setClubs] = useState([
                { id: 0, name: '注转 壮', students: [' ', '砖专 ', '住 专', '注 专拽', '专 砖驻专'] },
                { id: 1, name: '注转 壮', students: [' ', '注专 ', '转专 ', '专 驻专抓', '专 抓'] },
                { id: 2, name: '注转 壮', students: [' 专', ' 专', '砖 专', '注 ', '  '] }
            ]);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const club = params.get('club');
                const admin = params.get('admin');
                if (admin === 'true') setIsAdmin(true);
                else if (club !== null) setClubId(parseInt(club));
            }, []);

            useEffect(() => {
                const loadData = async () => {
                    const saved = await storage.get('attendance-data');
                    if (saved) setAttendanceData(JSON.parse(saved));
                    const savedClubs = await storage.get('clubs-data');
                    if (savedClubs) setClubs(JSON.parse(savedClubs));
                    const savedNotes = await storage.get('daily-notes');
                    if (savedNotes) setDailyNotes(JSON.parse(savedNotes));
                };
                loadData();
            }, []);

            const backupData = () => {
                const data = { attendanceData, clubs, dailyNotes };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `_注转_${currentDate}.json`;
                link.click();
            };

            const toggleAttendance = (clubId, studentName) => {
                const key = `${currentDate}-${clubId}-${studentName}`;
                const newData = { ...attendanceData, [key]: !attendanceData[key] };
                setAttendanceData(newData);
                storage.set('attendance-data', JSON.stringify(newData));
            };

            const isPresent = (cId, sName, date = currentDate) => attendanceData[`${date}-${cId}-${sName}`] || false;

            const StaffView = () => {
                const currentClub = clubs.find(c => c.id === clubId);
                if (!currentClub) return null;
                const filteredStudents = currentClub.students.filter(s => s.includes(searchTerm));

                return (
                    <div className="space-y-6">
                        <div className="bg-white p-4 rounded-xl shadow-sm flex gap-2 items-center">
                            <Search className="text-gray-400" size={20} />
                            <input 
                                type="text" 
                                placeholder="驻砖 ..." 
                                className="w-full text-right outline-none"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-2xl font-bold mb-6 text-gray-800">{currentClub.name}</h3>
                            <div className="space-y-3">
                                {filteredStudents.map((student, idx) => (
                                    <button key={idx} onClick={() => toggleAttendance(clubId, student)}
                                        className={`w-full flex items-center gap-3 p-4 rounded-lg border-2 transition-all ${isPresent(clubId, student) ? 'bg-green-50 border-green-400' : 'bg-gray-50 border-gray-200'}`}>
                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center ${isPresent(clubId, student) ? 'bg-green-500' : 'bg-gray-300'}`}>
                                            {isPresent(clubId, student) && <Check className="text-white" size={16} />}
                                        </div>
                                        <span className="text-lg">{student}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // ... (砖专 拽 -AdminView -ReportsView 砖专  拽 拽专 砖)

            if (clubId === null && !isAdmin) return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100 p-6 text-center">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full">
                        <h1 className="text-2xl font-bold mb-4">砖! </h1>
                        <p> 砖转砖 拽砖专 砖 砖砖   住 注专转.</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-indigo-50 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-2xl font-bold text-indigo-900">转: {isAdmin ? "" : clubs[clubId]?.name}</h1>
                            <button onClick={backupData} className="flex gap-2 items-center bg-white px-4 py-2 rounded-lg shadow text-sm hover:bg-gray-50">
                                <Save size={18} />  转
                            </button>
                        </div>
                        {viewMode === 'staff' && !isAdmin && <StaffView />}
                        {isAdmin && <div className="text-center p-10 bg-white rounded-xl shadow">转爪转  -  注转 </div>}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AttendanceApp />, document.getElementById('root'));
    </script>
</body>
</html>
